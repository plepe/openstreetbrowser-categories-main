type: overpass
query:
  '12': |-
    (
      nwr[waterway~"^(dam|weir|waterfall|rapids|lock|lock_gate|sluice_gate)$"];
      nwr["seamark:restricted_area:restriction"~"no_entry|restricted_entry"];
      node["seamark:bridge:clearance_height"];
    )
feature:
  pre: |-
    {% if tags.waterway %}
      {% set key = 'waterway' %}
      {% set value = tags.waterway %}
    {% elseif attribute(tags, 'seamark:restricted_area:restriction') %}
      {% set key = 'seamark:restricted_area:restriction' %}
      {% set value = '' %}
    {% elseif attribute(tags, 'seamark:bridge:clearance_height') %}
      {% set key = 'seamark:bridge:clearance_height' %}
      {% set value = attribute(tags, 'seamark:bridge:clearance_height') | round %}
      {% if value > 4 %}
        {% set value = 4 %}
      {% endif %}
    {% endif %}

    {% set constIndex = (key ~ "=" ~ value) %}
    {% set item = const[constIndex] %}
  title: |
    {{ item['sign'] | raw }} {{ localizedTag(tags, 'name') | default(localizedTag(tags, 'key')) | default(localizedTag(tags, 'ref')) }}
  description: |
    {% if key == 'seamark:restricted_area:restriction' %}
      {{ attribute(tags, 'seamark:restricted_area:restriction') }}
    {% elseif key == 'seamark:bridge:clearance_height' %}
      {{ attribute(tags, 'seamark:bridge:clearance_height') }} Meters
    {% else %}
      {{ tagTrans(key, value) }}
    {% endif %}
  body: |-
    <dl>
      <dt>{{ keyTrans('Description') }}</dt>
      <dd>{{ localizedTag(tags, 'description') }}</dd>
      
      {% if attribute(tags, 'operator') %}
        <dt>{{ keyTrans('Operator') }}</dt>
        <dd>{{ attribute(tags, 'operator') ? tagTrans('operator', attribute(tags, 'operator')) : '' }}</dd>
      {% endif %}

      <dt>{{ trans('Photos') }}</dt>
      <dd>
        <ul>
          {% if attribute(tags, 'mapillary') %}
            <li><a href="https://www.mapillary.com/app/?focus=photo&pKey={{ attribute(tags, 'mapillary') }}" rel="noreferrer" target="_blank">Mapillary</a></li>
          {% endif %}
        </ul>
      </dd>

    </dl>
  markerSign: <i class="fas fa-exclamation-triangle"></i>
  markerSymbol: |
      {{ markerPointer({ fillColor: '#ff6700' }) }}
  listMarkerSymbol: |
    {{ markerCircle({ fillColor: '#ff6700' }) }}
  priority: |-
    {% if const[constIndex] is defined %}
      {{ const[constIndex]['priority'] }}
    {% else %}
      10
    {% endif %}
const:
  waterway=dam:
    sign: <i class="fas fa-sort-amount-down-alt"></i>
    priority: 0
  waterway=weir:
    sign: <i class="fas fa-sort-amount-up-alt"></i>
    priority: 0
  waterway=waterfall:
    sign: <i class="far fa-chart-bar"></i>
    priority: 0
  waterway=rapids:
    sign: <i class="fas fa-water"></i>
    priority: 0
  waterway=lock:
    sign: <i class="fas fa-lock"></i>
    priority: 1
  waterway=lock_gate:
    sign: <i class="fas fa-torii-gate"></i>
    priority: 1
  waterway=sluice_gate:
    sign: <i class="fas fa-grip-lines"></i>
    priority: 0
  seamark:restricted_area:restriction=:
    sign: <i class='fa fa-times-rectangle-o'></i>
    priority: 1
  seamark:bridge:clearance_height=0:
    sign: <i class='fa fa-thermometer-0'></i>
    priority: 0
  seamark:bridge:clearance_height=1:
    sign: <i class='fa fa-thermometer-1'></i>
    priority: 0
  seamark:bridge:clearance_height=2:
    sign: <i class='fa fa-thermometer-2'></i>
    priority: 0
  seamark:bridge:clearance_height=3:
    sign: <i class='fa fa-thermometer-3'></i>
    priority: 0
  seamark:bridge:clearance_height=4:
    sign: <i class='fa fa-thermometer-4'></i>
    priority: 0
